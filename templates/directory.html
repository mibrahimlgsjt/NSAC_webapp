{% extends 'base.html' %}

{% block content %}
<div class="max-w-7xl mx-auto pb-24" x-data="{ 
    search: '', 
    sectorFilter: '',
    statusFilter: ''
}">

    <!-- Header & Filters -->
    <div class="mb-10 text-center space-y-6">
        <h1 class="text-4xl font-black text-digital-lavender tracking-tight drop-shadow-sm">Campus Encyclopedia üêæ</h1>
        <p class="text-gray-500 font-bold text-lg">The official database of NUST's furry residents.</p>
        
        <!-- Search Bar -->
        <div class="max-w-2xl mx-auto relative group">
            <input x-model="search" type="text" placeholder="Search by name, tags, or description..." class="w-full pl-14 pr-6 py-5 rounded-full bg-white/80 border-2 border-white/50 shadow-lg focus:ring-4 focus:ring-digital-lavender/20 focus:border-digital-lavender transition text-lg font-bold placeholder-gray-400">
            <span class="absolute left-5 top-1/2 -translate-y-1/2 text-2xl grayscale group-focus-within:grayscale-0 transition">üîç</span>
        </div>

        <!-- Filters -->
        <div class="flex flex-wrap justify-center gap-3">
            <select x-model="sectorFilter" class="px-6 py-3 rounded-full bg-white/60 border-2 border-white/50 font-bold text-gray-600 shadow-sm focus:border-digital-lavender focus:ring-0 cursor-pointer hover:bg-white transition">
                <option value="">All Sectors</option>
                <option value="Concordia 1">Concordia 1</option>
                <option value="Concordia 2">Concordia 2</option>
                <option value="NBS">NBS</option>
                <option value="SEECS">SEECS</option>
                <option value="SADA">SADA</option>
                <option value="SMME">SMME</option>
                <option value="Retro Cafe">Retro Cafe</option>
                <option value="Margalla Cafe">Margalla Cafe</option>
                <option value="Sports Complex">Sports Complex</option>
            </select>

            <select x-model="statusFilter" class="px-6 py-3 rounded-full bg-white/60 border-2 border-white/50 font-bold text-gray-600 shadow-sm focus:border-digital-lavender focus:ring-0 cursor-pointer hover:bg-white transition">
                <option value="">All Health Statuses</option>
                <option value="Healthy">Healthy üíö</option>
                <option value="Sick">Sick ü§í</option>
                <option value="Injured">Injured ü§ï</option>
            </select>
        </div>
    </div>

    <!-- Animal Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 px-4">
        {% for animal in animals %}
        <a href="{{ url_for('public.animal_detail', animal_id=animal.id) }}" 
           class="glass p-6 rounded-[2.5rem] hover:scale-[1.02] transition duration-300 group flex flex-col h-full border-t-4 border-transparent hover:border-digital-lavender relative overflow-hidden"
           style="transition-delay: {{ loop.index0 * 50 }}ms"
           x-show="(search === '' || '{{ animal.name|lower }}'.includes(search.toLowerCase()) || '{{ animal.personality_tags|lower }}'.includes(search.toLowerCase()) || '{{ animal.identification_markers|lower }}'.includes(search.toLowerCase())) && (sectorFilter === '' || '{{ animal.current_sector }}' === sectorFilter) && (statusFilter === '' || '{{ animal.health_status }}' === statusFilter)"
           x-transition:enter="transition ease-out duration-300"
           x-transition:enter-start="opacity-0 scale-90"
           x-transition:enter-end="opacity-100 scale-100">
            
            <!-- Badge -->
            <div class="absolute top-4 right-4 z-10">
                <span class="px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest shadow-sm
                    {{ 'bg-green-100 text-green-600' if animal.health_status == 'Healthy' else 'bg-red-100 text-red-500 animate-pulse' }}">
                    {{ animal.health_status }}
                </span>
            </div>

            <!-- Image -->
            <div class="aspect-square rounded-[2rem] overflow-hidden mb-4 shadow-inner relative">
                <img src="{{ animal.image_url }}" alt="{{ animal.name }}" class="w-full h-full object-cover transform group-hover:scale-110 transition duration-700">
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-4 pt-12">
                    <p class="text-white font-black text-xl">{{ animal.name }}</p>
                    <p class="text-white/80 text-xs font-bold flex items-center gap-1">
                        <span>üìç</span> {{ animal.current_sector }}
                    </p>
                </div>
            </div>

            <!-- Content -->
            <div class="flex-1 flex flex-col justify-between space-y-4">
                <div>
                    <div class="flex flex-wrap gap-1 mb-2">
                        <span class="bg-purple-50 text-purple-500 px-2 py-1 rounded-lg text-[10px] font-bold border border-purple-100">
                            {{ animal.mood_badge }}
                        </span>
                        {% for tag in (animal.personality_tags.split(',')[:2] if animal.personality_tags else []) %}
                        <span class="bg-gray-100 text-gray-500 px-2 py-1 rounded-lg text-[10px] font-bold border border-gray-200">#{{ tag }}</span>
                        {% endfor %}
                    </div>
                    
                    <p class="text-xs text-gray-500 line-clamp-3 leading-relaxed">
                        {{ animal.identification_markers or 'No visible markers.' }}
                    </p>
                </div>

                <div class="pt-4 border-t border-gray-100 flex justify-between items-center text-xs font-bold text-gray-400">
                    <span>‚ù§Ô∏è {{ animal.likes }} Loves</span>
                    <span class="group-hover:translate-x-1 transition">View Profile ‚Üí</span>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>

    <!-- Empty State -->
    <div x-show="$el.parentElement.querySelectorAll('a[x-show='true']').length === 0" class="text-center py-20 opacity-50 hidden" :class="{ '!block': true }">
        <div class="text-6xl mb-4 animate-bounce">üôà</div>
        <h3 class="text-2xl font-black text-gray-400">Nothing to see here...</h3>
        <p class="text-gray-400 font-bold">Try adjusting your filters or search terms!</p>
    </div>

</div>
{% endblock %}
